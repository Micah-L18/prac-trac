<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Roster - PracTrac</title>
    <link rel="stylesheet" href="/css/glass-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .player-card {
            background: var(--glass-secondary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .player-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-orange);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        .player-avatar {
            width: 80px;
            height: 80px;
            border-radius: 0px;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: var(--spacing-md);
        }
        .player-position {
            background: var(--accent-orange);
            color: white;
            padding: 2px 8px;
            border-radius: 0px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .stat-mini {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-xs) 0;
            border-bottom: 1px solid var(--glass-border-light);
        }
        .stat-mini:last-child {
            border-bottom: none;
        }
        .jersey-number {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--glass-primary);
            color: var(--accent-orange);
            width: 40px;
            height: 40px;
            border-radius: 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            border: 2px solid var(--accent-orange);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-content">
            <a href="index.html" class="logo">üèê PracTrac</a>
            
            <!-- Mobile menu toggle button -->
            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <!-- Desktop navigation -->
            <nav>
                <ul class="nav-links">
                    <li><a href="index.html">Dashboard</a></li>
                    <li><a href="practice.html">Practice Plans</a></li>
                    <li><a href="past-practices.html">Past Practices</a></li>
                    <li><a href="roster.html" class="active">Roster</a></li>
                    <li><a href="drills.html">Drills</a></li>
                    <li><a href="settings.html">Settings</a></li>
                </ul>
            </nav>
            
            <!-- Mobile menu -->
            <nav class="mobile-menu">
                <ul class="nav-links">
                    <li><a href="index.html">Dashboard</a></li>
                    <li><a href="practice.html">Practice Plans</a></li>
                    <li><a href="past-practices.html">Past Practices</a></li>
                    <li><a href="roster.html" class="active">Roster</a></li>
                    <li><a href="drills.html">Drills</a></li>
                    <li><a href="settings.html">Settings</a></li>
                </ul>
                
                <!-- Mobile Team Selector -->
                <div id="mobileTeamSelector" class="mobile-team-selector-container" style="display: none;">
                    <!-- Mobile team selector will be populated by JavaScript -->
                </div>
                
                <!-- Mobile User Actions -->
                <div class="mobile-user-actions">
                    <span id="mobileUserGreeting">Guest User</span>
                    <a href="login.html" class="mobile-login-link">Login</a>
                    <button onclick="window.pracTracDemo.logout()" class="mobile-logout-btn" style="display: none;">Logout</button>
                </div>
            </nav>
            
            <div class="nav-user">
                <span id="userGreeting">Guest User</span>
                <a href="login.html" class="login-link" style="margin-left: 10px;">Login</a>
                <div id="teamSelector" class="team-selector-container" style="display: none; margin-left: 10px;">
                    <!-- Team selector will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Header -->
        <section class="flex-between mb-xl roster-header">
            <div>
                <h1 style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-sm);">
                    Team Roster
                </h1>
                <p id="teamNameDisplay" style="color: var(--text-secondary); font-size: var(--font-size-lg);">
                    Loading team information...
                </p>
            </div>
            <button class="glass-button primary" onclick="addNewPlayer()">
                üë§ Add Player
            </button>
        </section>

        <!-- Team Selector for Roster -->
        <section class="glass-card mb-lg">
            <div class="p-lg">
                <h3 style="color: var(--accent-orange); font-size: var(--font-size-lg); margin-bottom: var(--spacing-md);">
                    üìã Select Team to View
                </h3>
                <div style="display: flex; gap: var(--spacing-md); align-items: center; flex-wrap: wrap;">
                    <select id="rosterTeamSelector" class="glass-select" style="min-width: 200px;">
                        <option value="">Loading teams...</option>
                    </select>
                    <button id="refreshRosterBtn" class="glass-button" onclick="refreshRosterData()" style="display: none;">
                        üîÑ 
                    </button>
                </div>
            </div>
        </section>

        <!-- Team Overview -->
        <section class="glass-card mb-xl roster-team-overview">
            <div class="p-lg">
                <h2 class="mb-lg" style="color: var(--accent-orange); font-size: var(--font-size-2xl);">
                    üìä Team Overview
                </h2>
                
                <div class="grid grid-4 gap-md">
                    <div class="text-center">
                        <div id="totalPlayers" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-orange);">0</div>
                        <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">Total Players</div>
                    </div>
                    <div class="text-center">
                        <div id="attendanceRate" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-green);">0%</div>
                        <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">Attendance Rate</div>
                    </div>
                    <div class="text-center">
                        <div id="avgSkillLevel" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-blue);">0</div>
                        <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">Avg Skill Level</div>
                    </div>
                    <div class="text-center">
                        <div id="avgHeight" style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--accent-amber);">0</div>
                        <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">Avg Height</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Player Cards Grid -->
        <section class="grid grid-3 gap-lg mb-xl" id="playerGrid">
            <!-- Players will be loaded here -->
        </section>


    </main>

    <!-- Add Player Modal -->
    <div id="addPlayerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--accent-orange); margin: 0;">üë§ Add New Player</h2>
                <button class="modal-close" onclick="closeAddPlayerModal()">‚úï</button>
            </div>
            <form id="addPlayerForm" onsubmit="submitNewPlayer(event)">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="firstName">First Name</label>
                        <input type="text" id="firstName" name="firstName" class="glass-input" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name</label>
                        <input type="text" id="lastName" name="lastName" class="glass-input" required>
                    </div>
                    <div class="form-group">
                        <label for="jerseyNumber">Jersey Number</label>
                        <input type="number" id="jerseyNumber" name="jerseyNumber" class="glass-input" min="1" max="99" required>
                    </div>
                    <div class="form-group">
                        <label for="position">Position</label>
                        <select id="position" name="position" class="glass-input" required>
                            <option value="">Select Position</option>
                            <option value="Setter">Setter</option>
                            <option value="Outside Hitter">Outside Hitter</option>
                            <option value="Middle Blocker">Middle Blocker</option>
                            <option value="Right Side">Right Side</option>
                            <option value="Libero">Libero</option>
                            <option value="Defensive Specialist">Defensive Specialist</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="height">Height</label>
                        <input type="text" id="height" name="height" class="glass-input" placeholder="e.g., 5'8&quot;">
                    </div>
                    <div class="form-group">
                        <label for="year">Year</label>
                        <select id="year" name="year" class="glass-input" required>
                            <option value="">Select Year</option>
                            <option value="Freshman">Freshman</option>
                            <option value="Sophomore">Sophomore</option>
                            <option value="Junior">Junior</option>
                            <option value="Senior">Senior</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="skillLevel">Skill Level</label>
                        <select id="skillLevel" name="skillLevel" class="glass-input" required>
                            <option value="">Select Level</option>
                            <option value="1">1 - Beginner</option>
                            <option value="2">2 - Developing</option>
                            <option value="3">3 - Intermediate</option>
                            <option value="4">4 - Advanced</option>
                            <option value="5">5 - Elite</option>
                        </select>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="glass-button" onclick="closeAddPlayerModal()">Cancel</button>
                    <button type="submit" class="glass-button primary">Add Player</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Player Modal -->
    <div id="editPlayerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="color: var(--accent-orange); margin: 0;">‚úèÔ∏è Edit Player</h2>
                <button class="modal-close" onclick="closeEditPlayerModal()">‚úï</button>
            </div>
            <form id="editPlayerForm" onsubmit="submitEditPlayer(event)">
                <input type="hidden" id="editPlayerId" name="playerId">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="editFirstName">First Name</label>
                        <input type="text" id="editFirstName" name="firstName" class="glass-input" required>
                    </div>
                    <div class="form-group">
                        <label for="editLastName">Last Name</label>
                        <input type="text" id="editLastName" name="lastName" class="glass-input" required>
                    </div>
                    <div class="form-group">
                        <label for="editJerseyNumber">Jersey Number</label>
                        <input type="number" id="editJerseyNumber" name="jerseyNumber" class="glass-input" min="1" max="99" required>
                    </div>
                    <div class="form-group">
                        <label for="editPosition">Position</label>
                        <select id="editPosition" name="position" class="glass-input" required>
                            <option value="">Select Position</option>
                            <option value="Setter">Setter</option>
                            <option value="Outside Hitter">Outside Hitter</option>
                            <option value="Middle Blocker">Middle Blocker</option>
                            <option value="Right Side">Right Side</option>
                            <option value="Libero">Libero</option>
                            <option value="Defensive Specialist">Defensive Specialist</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editHeight">Height</label>
                        <input type="text" id="editHeight" name="height" class="glass-input" placeholder="e.g., 5'8&quot;">
                    </div>
                    <div class="form-group">
                        <label for="editYear">Year</label>
                        <select id="editYear" name="year" class="glass-input" required>
                            <option value="">Select Year</option>
                            <option value="Freshman">Freshman</option>
                            <option value="Sophomore">Sophomore</option>
                            <option value="Junior">Junior</option>
                            <option value="Senior">Senior</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editSkillLevel">Skill Level</label>
                        <select id="editSkillLevel" name="skillLevel" class="glass-input" required>
                            <option value="">Select Level</option>
                            <option value="1">1 - Beginner</option>
                            <option value="2">2 - Developing</option>
                            <option value="3">3 - Intermediate</option>
                            <option value="4">4 - Advanced</option>
                            <option value="5">5 - Elite</option>
                        </select>
                    </div>
                </div>
                
                <!-- Stats Section -->
                <div style="margin-top: var(--spacing-lg);">
                    <h3 style="color: var(--accent-orange); margin-bottom: var(--spacing-md);">Player Statistics</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="editKills">Kills</label>
                            <input type="number" id="editKills" name="kills" class="glass-input" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editBlocks">Blocks</label>
                            <input type="number" id="editBlocks" name="blocks" class="glass-input" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editAces">Aces</label>
                            <input type="number" id="editAces" name="aces" class="glass-input" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label for="editDigs">Digs</label>
                            <input type="number" id="editDigs" name="digs" class="glass-input" min="0" placeholder="0">
                        </div>
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="glass-button" onclick="closeEditPlayerModal()">Cancel</button>
                    <button type="submit" class="glass-button primary">Update Player</button>
                </div>
            </form>
        </div>
    </div>

    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--glass-primary);
            border: 1px solid var(--glass-border);
            border-radius: 0;
            padding: var(--spacing-xl);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: var(--font-size-xl);
            cursor: pointer;
            padding: var(--spacing-sm);
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
            font-weight: 500;
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-sm) var(--spacing-md);
            color: var(--text-primary);
            font-size: var(--font-size-base);
        }

        .glass-input:focus {
            outline: none;
            border-color: var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .modal-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>

    <script>
        // Initialize roster team selector
        async function initializeRosterTeamSelector() {
            try {
                if (window.pracTracDemo && window.pracTracDemo.currentUser) {
                    const teams = await window.pracTracDemo.loadUserTeams();
                    const currentTeam = await window.pracTracDemo.getCurrentTeam();
                    const selector = document.getElementById('rosterTeamSelector');
                    
                    if (teams.length === 0) {
                        selector.innerHTML = '<option value="">No teams available</option>';
                        return;
                    }
                    
                    // Populate team options
                    selector.innerHTML = teams.map(team => 
                        `<option value="${team.id}" ${team.id === currentTeam?.id ? 'selected' : ''}>
                            ${team.name} - ${team.season}
                        </option>`
                    ).join('');
                    
                    // Add event listener for team changes
                    selector.addEventListener('change', handleRosterTeamChange);
                    
                    // Show refresh button
                    document.getElementById('refreshRosterBtn').style.display = 'inline-block';
                } else {
                    // Guest mode - show demo team
                    const selector = document.getElementById('rosterTeamSelector');
                    selector.innerHTML = '<option value="demo">Demo Team - Fall 2025</option>';
                }
            } catch (error) {
                console.error('Error initializing roster team selector:', error);
                const selector = document.getElementById('rosterTeamSelector');
                selector.innerHTML = '<option value="">Error loading teams</option>';
            }
        }

        // Handle team change in roster selector
        async function handleRosterTeamChange(event) {
            const selectedTeamId = event.target.value;
            if (selectedTeamId && selectedTeamId !== 'demo') {
                try {
                    // Switch to the selected team
                    await window.pracTracDemo.switchTeam(parseInt(selectedTeamId));
                    // The page will reload automatically from the switchTeam function
                } catch (error) {
                    console.error('Error switching team:', error);
                    window.pracTracDemo.showNotification('Error switching team', 'error');
                }
            }
        }

        // Refresh roster data
        async function refreshRosterData() {
            try {
                await loadPlayerData();
                await window.pracTracDemo.updateTeamDisplays();
                window.pracTracDemo.showNotification('Roster data refreshed', 'success');
            } catch (error) {
                console.error('Error refreshing roster data:', error);
                window.pracTracDemo.showNotification('Error refreshing data', 'error');
            }
        }

        // Update team name display
        async function updateTeamNameDisplay() {
            try {
                // Get current team from the global pracTracDemo instance
                if (window.pracTracDemo && window.pracTracDemo.currentUser) {
                    const currentTeam = await window.pracTracDemo.getCurrentTeam();
                    const teamNameElement = document.getElementById('teamNameDisplay');
                    
                    if (currentTeam && teamNameElement) {
                        teamNameElement.textContent = `${currentTeam.name} ‚Ä¢ ${currentTeam.season}`;
                    } else if (teamNameElement) {
                        teamNameElement.textContent = 'No team selected ‚Ä¢ Please select a team';
                    }
                } else {
                    // Fallback for guest users
                    const teamNameElement = document.getElementById('teamNameDisplay');
                    if (teamNameElement) {
                        teamNameElement.textContent = 'Demo Team ‚Ä¢ Fall 2025 Season';
                    }
                }
            } catch (error) {
                console.error('Error updating team name display:', error);
                const teamNameElement = document.getElementById('teamNameDisplay');
                if (teamNameElement) {
                    teamNameElement.textContent = 'Demo Team ‚Ä¢ Fall 2025 Season';
                }
            }
        }

        // Update team overview with real data
        async function updateTeamOverview(players) {
            try {
                // Fetch team statistics from the API
                const response = await fetch('/api/team/stats');
                const teamStats = await response.json();
                
                // Update the DOM with real data using IDs
                document.getElementById('totalPlayers').textContent = teamStats.totalPlayers;
                document.getElementById('attendanceRate').textContent = teamStats.attendanceRate;
                document.getElementById('avgSkillLevel').textContent = teamStats.avgSkillLevel;
                document.getElementById('avgHeight').textContent = teamStats.avgHeight;
                
            } catch (error) {
                console.error('Error fetching team statistics:', error);
                // Fallback to client-side calculation
                const totalPlayers = players.length;
                const avgSkillLevel = totalPlayers > 0 ? 
                    (players.reduce((sum, player) => sum + player.skillLevel, 0) / totalPlayers).toFixed(1) : 0;
                
                // Calculate average height (fallback)
                let avgHeight = "N/A";
                if (totalPlayers > 0) {
                    const heights = players.filter(p => p.height && p.height.includes("'"));
                    if (heights.length > 0) {
                        const totalInches = heights.reduce((sum, player) => {
                            const [feet, inches] = player.height.split("'");
                            const inchPart = inches ? parseInt(inches.replace('"', '')) : 0;
                            return sum + (parseInt(feet) * 12 + inchPart);
                        }, 0);
                        const avgInches = totalInches / heights.length;
                        const avgFeet = Math.floor(avgInches / 12);
                        const avgRemainingInches = Math.round(avgInches % 12);
                        avgHeight = `${avgFeet}'${avgRemainingInches}"`;
                    }
                }
                
                // Update with fallback values
                document.getElementById('totalPlayers').textContent = totalPlayers;
                document.getElementById('attendanceRate').textContent = "N/A"; // No data available
                document.getElementById('avgSkillLevel').textContent = avgSkillLevel;
                document.getElementById('avgHeight').textContent = avgHeight;
            }
        }

        // Load player data
        async function loadPlayerData() {
            try {
                const response = await fetch('/api/players');
                const players = await response.json();
                
                // Update team overview with real data
                updateTeamOverview(players);
                
                // Load player cards
                const playerGrid = document.getElementById('playerGrid');
                playerGrid.innerHTML = ''; // Clear existing cards
                players.forEach(player => {
                    const card = document.createElement('div');
                    card.className = 'player-card';
                    
                    const initials = player.firstName.charAt(0) + player.lastName.charAt(0);
                    const skillStars = '‚≠ê'.repeat(player.skillLevel);
                    
                    card.innerHTML = `
                        <div class="jersey-number">${player.jerseyNumber}</div>
                        <div class="player-avatar">${initials}</div>
                        <h3 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">
                            ${player.firstName} ${player.lastName}
                        </h3>
                        <div class="flex-between mb-md">
                            <span class="player-position">${player.position}</span>
                            <span style="color: var(--text-secondary);">${player.year}</span>
                        </div>
                        <div style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">
                            Height: ${player.height} ‚Ä¢ Skill: ${skillStars}
                        </div>
                        
                        <div style="display: flex; gap: var(--spacing-xs);">
                            <button class="glass-button" onclick="editPlayer(${player.id})" style="flex: 1;">
                                ‚úèÔ∏è Edit
                            </button>
                            <button class="glass-button" onclick="viewPlayerProfile(${player.id})" style="flex: 1;">
                                üëÅÔ∏è View
                            </button>
                            <button class="glass-button danger" onclick="deletePlayer(${player.id}, '${player.firstName} ${player.lastName}')" style="flex: 1;">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                    
                    playerGrid.appendChild(card);
                });

                // Load roster table
                const rosterTable = document.getElementById('rosterTable');
                rosterTable.innerHTML = ''; // Clear existing rows
                players.forEach(player => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="font-weight: 700; color: var(--accent-orange);">${player.jerseyNumber}</td>
                        <td>
                            <div style="font-weight: 600;">${player.firstName} ${player.lastName}</div>
                            <div style="color: var(--text-tertiary); font-size: var(--font-size-sm);">${player.year}</div>
                        </td>
                        <td>
                            <span class="player-position" style="font-size: 10px; padding: 1px 6px;">
                                ${player.position}
                            </span>
                        </td>
                        <td>${player.year}</td>
                        <td>${player.height}</td>
                        <td>
                            <button class="glass-button" onclick="editPlayer(${player.id})" 
                                    style="padding: 4px 8px; font-size: 12px; margin-right: 4px;">
                                ‚úèÔ∏è Edit
                            </button>
                            <button class="glass-button" onclick="viewPlayerProfile(${player.id})" 
                                    style="padding: 4px 8px; font-size: 12px; margin-right: 4px;">
                                üëÅÔ∏è View
                            </button>
                            <button class="glass-button danger" onclick="deletePlayer(${player.id}, '${player.firstName} ${player.lastName}')" 
                                    style="padding: 4px 8px; font-size: 12px;">
                                üóëÔ∏è Delete
                            </button>
                        </td>
                    `;
                    rosterTable.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading player data:', error);
            }
        }

        function addNewPlayer() {
            document.getElementById('addPlayerModal').style.display = 'flex';
        }

        function closeAddPlayerModal() {
            document.getElementById('addPlayerModal').style.display = 'none';
            document.getElementById('addPlayerForm').reset();
        }

        async function submitNewPlayer(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const playerData = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                jerseyNumber: parseInt(formData.get('jerseyNumber')),
                position: formData.get('position'),
                skillLevel: parseInt(formData.get('skillLevel')),
                height: formData.get('height'),
                year: formData.get('year')
            };

            try {
                const response = await fetch('/api/players', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(playerData)
                });

                if (response.ok) {
                    const newPlayer = await response.json();
                    
                    // Close modal and refresh the player list
                    closeAddPlayerModal();
                    loadPlayerData();
                    
                    // Show success notification
                    if (window.pracTracDemo) {
                        window.pracTracDemo.showNotification('Player added successfully!', 'success');
                    }
                } else {
                    throw new Error('Failed to add player');
                }
            } catch (error) {
                console.error('Error adding player:', error);
                if (window.pracTracDemo) {
                    window.pracTracDemo.showNotification('Error adding player', 'error');
                }
            }
        }

        function viewPlayerProfile(playerId) {
            // In a real app, this would navigate to player profile page
            window.location.href = `player-profile.html?player=${playerId}`;
        }

        async function deletePlayer(playerId, playerName) {
            const confirmed = await showGlassConfirm(
                `Are you sure you want to delete ${playerName}? This action cannot be undone and will remove all attendance records for this player.`,
                'Delete Player'
            );
            
            if (confirmed) {
                fetch(`/api/players/${playerId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showGlassError(`Error: ${data.error}`);
                    } else {
                        showGlassSuccess('Player deleted successfully');
                        loadPlayerData(); // Reload the player list
                    }
                })
                .catch(error => {
                    console.error('Error deleting player:', error);
                    showGlassError('Error deleting player');
                });
            }
        }

        function editPlayer(playerId) {
            // Fetch player data and populate the edit form
            fetch(`/api/players/${playerId}`)
                .then(response => response.json())
                .then(player => {
                    document.getElementById('editPlayerId').value = player.id;
                    document.getElementById('editFirstName').value = player.firstName;
                    document.getElementById('editLastName').value = player.lastName;
                    document.getElementById('editJerseyNumber').value = player.jerseyNumber;
                    document.getElementById('editPosition').value = player.position;
                    document.getElementById('editHeight').value = player.height;
                    document.getElementById('editYear').value = player.year;
                    document.getElementById('editSkillLevel').value = player.skillLevel;
                    
                    // Populate stats
                    document.getElementById('editKills').value = player.stats.kills || 0;
                    document.getElementById('editBlocks').value = player.stats.blocks || 0;
                    document.getElementById('editAces').value = player.stats.aces || 0;
                    document.getElementById('editDigs').value = player.stats.digs || 0;
                    
                    // Show the modal
                    document.getElementById('editPlayerModal').style.display = 'flex';
                })
                .catch(error => {
                    console.error('Error fetching player data:', error);
                    if (window.pracTracDemo) {
                        window.pracTracDemo.showNotification('Error loading player data', 'error');
                    }
                });
        }

        function closeEditPlayerModal() {
            document.getElementById('editPlayerModal').style.display = 'none';
            document.getElementById('editPlayerForm').reset();
        }

        async function submitEditPlayer(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const playerId = formData.get('playerId');
            const playerData = {
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                jerseyNumber: parseInt(formData.get('jerseyNumber')),
                position: formData.get('position'),
                skillLevel: parseInt(formData.get('skillLevel')),
                height: formData.get('height'),
                year: formData.get('year'),
                stats: {
                    kills: parseInt(formData.get('kills')) || 0,
                    blocks: parseInt(formData.get('blocks')) || 0,
                    aces: parseInt(formData.get('aces')) || 0,
                    digs: parseInt(formData.get('digs')) || 0,
                    assists: 0 // Default value, can be added to form later if needed
                }
            };

            try {
                const response = await fetch(`/api/players/${playerId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(playerData)
                });

                if (response.ok) {
                    const updatedPlayer = await response.json();
                    
                    // Close modal and refresh the player list
                    closeEditPlayerModal();
                    location.reload(); // Refresh the page to show updated data
                    
                    // Show success notification
                    if (window.pracTracDemo) {
                        window.pracTracDemo.showNotification('Player updated successfully!', 'success');
                    }
                } else {
                    throw new Error('Failed to update player');
                }
            } catch (error) {
                console.error('Error updating player:', error);
                if (window.pracTracDemo) {
                    window.pracTracDemo.showNotification('Error updating player', 'error');
                }
            }
        }
        
        // Navigate to player profile page
        function viewPlayerProfile(playerId) {
            window.location.href = `player-profile.html?id=${playerId}`;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadPlayerData();
            
            // Initialize mobile menu
            if (typeof initializeMobileMenu === 'function') {
                initializeMobileMenu();
            }
            
            // Wait for main.js to load and then update team name
            setTimeout(() => {
                if (window.pracTracDemo) {
                    window.pracTracDemo.updateTeamDisplays();
                    initializeRosterTeamSelector();
                }
            }, 100);
        });
    </script>
    <script src="js/main.js"></script>
    <script>
        // Initialize PracTrac demo and check authentication
        window.pracTracDemo = new PracTracDemo();
    </script>
    <script src="/js/modal.js"></script>
</body>
</html>