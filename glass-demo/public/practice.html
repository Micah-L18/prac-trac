<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Plans - PracTrac</title>
    <link rel="stylesheet" href="/css/glass-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
        .phase-timeline { display: flex; gap: var(--spacing-sm); margin: var(--spacing-md) 0; }
        .phase-item { 
            flex: 1; 
            background: var(--glass-tertiary); 
            padding: var(--spacing-sm); 
            border-radius: var(--radius-sm); 
            text-align: center;
            border: 1px solid var(--glass-border);
            position: relative;
        }
        .phase-item.active {
            background: var(--accent-orange);
            color: var(--text-primary);
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }
        .timer-display {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-orange);
            text-align: center;
            margin: var(--spacing-lg) 0;
            font-family: 'Courier New', monospace;
        }
        .drill-card {
            background: var(--glass-secondary);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-sm);
        }
        .drill-card:hover {
            background: var(--glass-tertiary);
            border-color: var(--accent-orange);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav-container">
        <div class="nav-glass">
            <a href="/" class="logo">üèê PracTrac</a>
            <ul class="nav-links">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/practice" class="active">Practice Plans</a></li>
                <li><a href="/roster">Roster</a></li>
                <li><a href="/drills">Drills</a></li>
                <li><a href="/videos">Videos</a></li>
                <li><a href="/analytics">Analytics</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-container">
        <!-- Header -->
        <section class="flex-between mb-xl">
            <div>
                <h1 style="font-size: var(--font-size-3xl); font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-sm);">
                    Practice Plans
                </h1>
                <p style="color: var(--text-secondary); font-size: var(--font-size-lg);">
                    Create, manage, and execute volleyball practice sessions
                </p>
            </div>
            <button class="glass-button primary" onclick="createNewPractice()">
                ‚ûï New Practice Plan
            </button>
        </section>

        <div class="grid grid-2 gap-lg">
            <!-- Practice Builder -->
            <div class="glass-card">
                <div class="p-lg">
                    <h2 class="mb-lg" style="color: var(--accent-orange); font-size: var(--font-size-2xl);">
                        üèóÔ∏è Practice Builder
                    </h2>
                    
                    <div class="mb-md">
                        <label style="color: var(--text-secondary); display: block; margin-bottom: var(--spacing-xs);">
                            Practice Name
                        </label>
                        <input type="text" class="glass-input" placeholder="Championship Prep" value="Championship Prep">
                    </div>

                    <div class="grid grid-2 gap-md mb-md">
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: var(--spacing-xs);">
                                Date
                            </label>
                            <input type="date" class="glass-input" value="2025-10-08">
                        </div>
                        <div>
                            <label style="color: var(--text-secondary); display: block; margin-bottom: var(--spacing-xs);">
                                Total Duration
                            </label>
                            <input type="number" class="glass-input" placeholder="120" value="120"> 
                            <small style="color: var(--text-tertiary);">minutes</small>
                        </div>
                    </div>

                    <h3 class="mb-md" style="color: var(--text-primary);">Practice Phases</h3>
                    
                    <div class="phase-timeline">
                        <div class="phase-item">
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Warm-up</div>
                            <div style="color: var(--text-tertiary); font-size: var(--font-size-xs);">15 min</div>
                        </div>
                        <div class="phase-item active">
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Skills</div>
                            <div style="color: var(--text-tertiary); font-size: var(--font-size-xs);">45 min</div>
                        </div>
                        <div class="phase-item">
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Scrimmage</div>
                            <div style="color: var(--text-tertiary); font-size: var(--font-size-xs);">40 min</div>
                        </div>
                        <div class="phase-item">
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Cool Down</div>
                            <div style="color: var(--text-tertiary); font-size: var(--font-size-xs);">20 min</div>
                        </div>
                    </div>

                    <div class="mt-lg">
                        <button class="glass-button primary" onclick="startPractice()">
                            ‚ñ∂Ô∏è Start Practice
                        </button>
                        <button class="glass-button" onclick="savePractice()">
                            üíæ Save Template
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Practice Timer -->
            <div class="glass-card">
                <div class="p-lg text-center">
                    <h2 class="mb-lg" style="color: var(--accent-orange); font-size: var(--font-size-2xl);">
                        ‚è±Ô∏è Live Practice Timer
                    </h2>
                    
                    <div class="timer-display" id="practiceTimer">
                        45:30
                    </div>
                    
                    <div style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">
                        <strong>Current Phase:</strong> Skill Development<br>
                        <span style="color: var(--text-tertiary);">Phase 2 of 4</span>
                    </div>

                    <div class="flex-center gap-md mb-lg">
                        <button class="glass-button" onclick="pauseTimer()" id="pauseBtn">
                            ‚è∏Ô∏è Pause
                        </button>
                        <button class="glass-button" onclick="skipPhase()">
                            ‚è≠Ô∏è Skip Phase
                        </button>
                        <button class="glass-button" onclick="addTime()">
                            ‚ûï Add 5 min
                        </button>
                    </div>

                    <div class="glass-card p-md" style="text-align: left;">
                        <h4 style="color: var(--accent-orange); margin-bottom: var(--spacing-sm);">
                            Current Phase Drills:
                        </h4>
                        <div class="drill-card drill-with-video">
                            <div class="flex-between">
                                <div>
                                    <div style="font-weight: 600;">Attack Line Hitting</div>
                                    <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                                        Difficulty: ‚≠ê‚≠ê‚≠ê‚≠ê ‚Ä¢ 20 minutes
                                    </div>
                                </div>
                                <button class="glass-button" onclick="playDrillVideo(2)" style="padding: 4px 8px; font-size: 12px;">
                                    ‚ñ∂Ô∏è Watch
                                </button>
                            </div>
                            <div class="drill-video-assignment">
                                <div class="video-thumbnail-small">‚ñ∂Ô∏è</div>
                                <div class="video-info">
                                    <div class="video-title-small">Perfect Spike Technique</div>
                                    <div class="video-duration-small">3:45</div>
                                </div>
                                <button class="remove-video-btn" onclick="removeVideoFromDrill(2, 1)">‚úï</button>
                            </div>
                        </div>
                        <div class="drill-card">
                            <div class="flex-between">
                                <div>
                                    <div style="font-weight: 600;">Serve and Pass</div>
                                    <div style="color: var(--text-secondary); font-size: var(--font-size-sm);">
                                        Difficulty: ‚≠ê‚≠ê‚≠ê ‚Ä¢ 15 minutes
                                    </div>
                                </div>
                                <button class="assign-video-btn" onclick="assignVideoToDrill(4)">
                                    üìπ Assign Video
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Practice Templates -->
        <section class="glass-card mt-xl">
            <div class="p-lg">
                <h2 class="mb-lg" style="color: var(--accent-orange); font-size: var(--font-size-2xl);">
                    üìã Practice Templates
                </h2>
                
                <div class="grid grid-3 gap-md" id="practiceTemplates">
                    <!-- Templates will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Recent Practices -->
        <section class="glass-card mt-xl">
            <div class="p-lg">
                <h2 class="mb-lg" style="color: var(--accent-orange); font-size: var(--font-size-2xl);">
                    üìÖ Recent Practice Sessions
                </h2>
                
                <table class="glass-table">
                    <thead>
                        <tr>
                            <th>Practice Name</th>
                            <th>Date</th>
                            <th>Duration</th>
                            <th>Attendance</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentPractices">
                        <!-- Practices will be loaded here -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- Video Selector Modal -->
    <div id="videoSelectorModal" class="video-selector-modal">
        <div class="video-selector-content">
            <div class="flex-between mb-lg">
                <h2 style="color: var(--accent-orange);">üìπ Assign Video to Drill</h2>
                <button class="glass-button" onclick="closeVideoSelector()">‚úï Close</button>
            </div>
            
            <div>
                <label style="color: var(--text-secondary); display: block; margin-bottom: var(--spacing-xs);">
                    Search Videos
                </label>
                <input type="text" class="glass-input" placeholder="Search demonstration videos..." 
                       id="videoSearchInput" onkeyup="filterVideosInSelector()">
            </div>

            <div class="video-grid-selector" id="videoGridSelector">
                <!-- Videos will be loaded here -->
            </div>

            <div class="flex-center mt-lg">
                <button class="glass-button primary" onclick="confirmVideoAssignment()" id="confirmVideoBtn" disabled>
                    ‚úÖ Assign Selected Video
                </button>
            </div>
        </div>
    </div>

    <script>
        // Timer functionality
        let timerInterval;
        let isPaused = false;
        let currentTime = 45 * 60 + 30; // 45:30 in seconds
        let currentDrillId = null;
        let selectedVideoId = null;
        let availableVideos = [];

        function updateTimerDisplay() {
            const minutes = Math.floor(currentTime / 60);
            const seconds = currentTime % 60;
            document.getElementById('practiceTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startPractice() {
            // Launch into dedicated practice mode
            window.location.href = '/practice-mode.html';
        }

        function pauseTimer() {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').innerHTML = isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        }

        function skipPhase() {
            currentTime = 40 * 60; // Skip to next phase
            updateTimerDisplay();
        }

        function addTime() {
            currentTime += 5 * 60; // Add 5 minutes
            updateTimerDisplay();
        }

        function createNewPractice() {
            alert('New Practice Plan Builder would open here!');
        }

        function savePractice() {
            alert('Practice saved as template!');
        }

        // Video Assignment Functions
        async function assignVideoToDrill(drillId) {
            currentDrillId = drillId;
            await loadVideosForSelector();
            document.getElementById('videoSelectorModal').style.display = 'flex';
        }

        async function loadVideosForSelector() {
            try {
                const response = await fetch('/api/videos');
                availableVideos = await response.json();
                
                // Add more demo videos for selection
                const additionalVideos = [
                    {
                        id: 10,
                        title: "Serving Accuracy Drill",
                        category: "Serving",
                        duration: "4:20",
                        description: "Master serving placement and consistency"
                    },
                    {
                        id: 11,
                        title: "Passing Fundamentals",
                        category: "Defense",
                        duration: "5:15",
                        description: "Basic passing technique and positioning"
                    },
                    {
                        id: 12,
                        title: "Quick Attack Timing",
                        category: "Attacking",
                        duration: "3:30",
                        description: "Perfect timing for quick attacks"
                    }
                ];
                
                availableVideos = [...availableVideos, ...additionalVideos];
                renderVideoSelector();
            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        function renderVideoSelector() {
            const videoGrid = document.getElementById('videoGridSelector');
            videoGrid.innerHTML = '';

            availableVideos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-selector-item';
                videoItem.onclick = () => selectVideo(video.id);
                
                videoItem.innerHTML = `
                    <div class="video-thumbnail-small" style="width: 100%; height: 80px; margin-bottom: var(--spacing-sm);">
                        ‚ñ∂Ô∏è
                    </div>
                    <div class="video-title-small" style="margin-bottom: var(--spacing-xs);">
                        ${video.title}
                    </div>
                    <div class="video-duration-small" style="margin-bottom: var(--spacing-xs);">
                        ${video.duration} ‚Ä¢ ${video.category}
                    </div>
                    <div style="font-size: 11px; color: var(--text-tertiary); line-height: 1.3;">
                        ${video.description}
                    </div>
                `;
                
                videoGrid.appendChild(videoItem);
            });
        }

        function selectVideo(videoId) {
            // Remove previous selection
            document.querySelectorAll('.video-selector-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selection to clicked item
            event.target.closest('.video-selector-item').classList.add('selected');
            selectedVideoId = videoId;
            
            // Enable confirm button
            document.getElementById('confirmVideoBtn').disabled = false;
        }

        function confirmVideoAssignment() {
            if (selectedVideoId && currentDrillId) {
                const selectedVideo = availableVideos.find(v => v.id === selectedVideoId);
                if (selectedVideo) {
                    alert(`Video "${selectedVideo.title}" assigned to drill! 
                    
Now coaches can:
üì± View video on iPad during practice
üéØ Show technique to players instantly
‚è±Ô∏è Reference during drill execution
üé• Demonstrate proper form`);
                    
                    closeVideoSelector();
                }
            }
        }

        function closeVideoSelector() {
            document.getElementById('videoSelectorModal').style.display = 'none';
            selectedVideoId = null;
            currentDrillId = null;
            document.getElementById('confirmVideoBtn').disabled = true;
        }

        function filterVideosInSelector() {
            const searchTerm = document.getElementById('videoSearchInput').value.toLowerCase();
            const filteredVideos = availableVideos.filter(video => 
                video.title.toLowerCase().includes(searchTerm) ||
                video.category.toLowerCase().includes(searchTerm) ||
                video.description.toLowerCase().includes(searchTerm)
            );
            
            const videoGrid = document.getElementById('videoGridSelector');
            videoGrid.innerHTML = '';

            filteredVideos.forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-selector-item';
                videoItem.onclick = () => selectVideo(video.id);
                
                videoItem.innerHTML = `
                    <div class="video-thumbnail-small" style="width: 100%; height: 80px; margin-bottom: var(--spacing-sm);">
                        ‚ñ∂Ô∏è
                    </div>
                    <div class="video-title-small" style="margin-bottom: var(--spacing-xs);">
                        ${video.title}
                    </div>
                    <div class="video-duration-small" style="margin-bottom: var(--spacing-xs);">
                        ${video.duration} ‚Ä¢ ${video.category}
                    </div>
                    <div style="font-size: 11px; color: var(--text-tertiary); line-height: 1.3;">
                        ${video.description}
                    </div>
                `;
                
                videoGrid.appendChild(videoItem);
            });
        }

        function playDrillVideo(drillId) {
            alert('Playing assigned drill video! üé•\n\nIn the full app:\n‚Ä¢ Video opens in full-screen player\n‚Ä¢ Slow-motion controls available\n‚Ä¢ Can add annotations during playback\n‚Ä¢ Perfect for showing technique during practice');
        }

        function removeVideoFromDrill(drillId, videoId) {
            if (confirm('Remove video assignment from this drill?')) {
                alert('Video assignment removed from drill');
                // In real app, would update the drill card display
            }
        }

        // Load practice data
        async function loadPracticeData() {
            try {
                const response = await fetch('/api/practices');
                const practices = await response.json();
                
                // Load templates with video assignment capabilities
                const templatesContainer = document.getElementById('practiceTemplates');
                practices.forEach(practice => {
                    const template = document.createElement('div');
                    template.className = 'glass-card p-md';
                    template.innerHTML = `
                        <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-sm);">
                            ${practice.name}
                        </h4>
                        <div style="color: var(--text-secondary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-sm);">
                            ${practice.duration} minutes ‚Ä¢ ${practice.phases.length} phases
                        </div>
                        <div style="color: var(--text-tertiary); font-size: var(--font-size-sm); margin-bottom: var(--spacing-md);">
                            üìπ Includes ${Math.floor(Math.random() * 3) + 1} demonstration videos
                        </div>
                        <div class="flex gap-sm">
                            <button class="glass-button" onclick="useTemplate(${practice.id})" style="flex: 1;">
                                Use Template
                            </button>
                            <button class="glass-button" onclick="previewTemplateVideos(${practice.id})" style="padding: 6px 8px;">
                                üé•
                            </button>
                        </div>
                    `;
                    templatesContainer.appendChild(template);
                });

                // Load recent practices
                const recentContainer = document.getElementById('recentPractices');
                practices.forEach(practice => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td style="font-weight: 600;">${practice.name}</td>
                        <td>${practice.date}</td>
                        <td>${practice.duration} min</td>
                        <td>6/6</td>
                        <td style="color: var(--accent-green);">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                        <td>
                            <div class="flex gap-sm">
                                <button class="glass-button" style="padding: 4px 8px; font-size: 12px;" onclick="viewPractice(${practice.id})">
                                    View
                                </button>
                                <button class="glass-button" style="padding: 4px 8px; font-size: 12px;" onclick="viewPracticeVideos(${practice.id})">
                                    üé•
                                </button>
                            </div>
                        </td>
                    `;
                    recentContainer.appendChild(row);
                });
            } catch (error) {
                console.error('Error loading practice data:', error);
            }
        }

        function useTemplate(practiceId) {
            alert(`Using template ${practiceId} for new practice! Videos will be automatically assigned to drills.`);
        }

        function previewTemplateVideos(practiceId) {
            alert('Template Video Preview:\n\nüé• Perfect Spike Technique (3:45)\nüé• Blocking Fundamentals (5:30)\nüé• Serve and Pass Drills (4:20)\n\nAll videos will be available during practice execution!');
        }

        function viewPracticeVideos(practiceId) {
            alert('Practice Video Library:\n\nüìπ View all assigned videos\n‚è±Ô∏è See video timing in practice phases\nüéØ Quick access during live practice\nüìä Track video usage analytics');
        }

        function viewPractice(practiceId) {
            alert(`Viewing practice ${practiceId} details`);
        }

        // Close modal when clicking outside
        document.getElementById('videoSelectorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeVideoSelector();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadPracticeData();
            updateTimerDisplay();
        });
    </script>
</body>
</html>